<h2 id="列表篇"><a href="#列表篇" class="headerlink" title="列表篇"></a>列表篇</h2><p><code>Al-Block-Crud</code>对列表进行了二次封装，意为开发带来更多的便利，减少开发时多余代码的<code>Ctrl+c</code>、<code>Ctrl+v</code>。</p>
<h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><ul>
<li style="list-style: none"><input type="checkbox" checked></input> 本地数据或远程数据展示</li>
<li style="list-style: none"><input type="checkbox" checked></input> 初始选中状态设置</li>
<li style="list-style: none"><input type="checkbox" checked></input> 集成分页组件</li>
<li style="list-style: none"><input type="checkbox" checked></input> 自定义列表项</li>
<li style="list-style: none"><input type="checkbox" checked></input> 兼容<code>element-ui</code>所有属性</li>
<li style="list-style: none"><input type="checkbox"></input> 本地数据分页</li>
</ul>
<h3 id="props-对象"><a href="#props-对象" class="headerlink" title="props 对象"></a>props 对象</h3><pre><code>selectedKeys: [&apos;1&apos;]

tableMap: {
  options: {},
  columns: [],
  dataSource: [],
  listeners: {}
}

pagination: {
  pageSizes: [10, 20, 50, 100],
  pageSize: 10,
  pageIndex: 1,
  total: 0,
  layout: &apos;sizes, prev, pager, next, total, -&gt;&apos;
}

</code></pre><blockquote>
<ol>
<li><code>pagination</code>为所见参数配置，默认开启，设置 boolean 类型的 false 则关闭，开启时需在引用组件时进行配置使用，如获取<code>pageSize</code>的路径</li>
<li><code>pageSize</code>和<code>pageIndex</code>为本次案例使用的分页信息，实际使用中请配置成项目字段</li>
<li><code>tableMap.dataSource</code>为列表数据源，优先使用</li>
<li><code>tableMap.listeners</code>为列表事件监听集合，可自由添加配置</li>
<li><code>selectedKeys</code>为选中行的 key 值，需要在<code>table/options</code>下设置行关键值<code>currentRowKey</code>，<code>currentRowKey</code>默认为<code>id</code></li>
</ol>
</blockquote>
<h3 id="options-对象"><a href="#options-对象" class="headerlink" title="options 对象"></a>options 对象</h3><table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">函数参数</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>immediately</td>
<td style="text-align:left">是否在页面加载完成立即请求列表数据</td>
<td style="text-align:left">Boolean/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td>requestApi</td>
<td style="text-align:left">请求列表数据函数，需返回 Promise 对象</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>requestParams</td>
<td style="text-align:left">除去分页信息外的参数对象，可直接传入 JSON 对象或提供返回值为 JSON 对象的函数</td>
<td style="text-align:left">Object/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>deleteApi</td>
<td style="text-align:left">删除数据地址，需返回 Promise 对象，参数来自调用<a href="#方法">删除方法</a>时传入的值</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>firstCellType</td>
<td style="text-align:left">第一列类型。有效值<code>selection</code>、<code>index</code>、<code>expand</code>、<code>none</code>， 为 expand 时在组件中嵌入名称为<code>expand</code>的作用域插槽（与其他行取值一致）, <code>none</code>为不显示</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left">selection</td>
</tr>
<tr>
<td>headerCellStyle</td>
<td style="text-align:left">表头样式，可在引用组件时进行配置使用</td>
<td style="text-align:left">Object</td>
<td style="text-align:left">不可使用函数</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>onRequestSuccess</td>
<td style="text-align:left">请求成功的回调</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">xhrResponse</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>onRequestError</td>
<td style="text-align:left">请求失败的回调</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">error</td>
<td style="text-align:left">依赖全局配置中 <code>table.on_request_error</code></td>
</tr>
<tr>
<td>…</td>
<td style="text-align:left">elementUI 表格的其他属性，可自由配置</td>
<td style="text-align:left">不可使用函数</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li><code>height</code>、<code>stripe</code>、<code>border</code>已在引用组件时进行配置使用</li>
<li><code>ref</code> 由于 ref 值非响应数据，故封装的时候将<code>el-table</code>的<code>ref</code>确定为<code>alBlockTable</code></li>
</ul>
</blockquote>
<h3 id="columns-数组对象"><a href="#columns-数组对象" class="headerlink" title="columns 数组对象"></a>columns 数组对象</h3><table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">函数参数</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>field</td>
<td style="text-align:left">映射标识</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>label</td>
<td style="text-align:left">显示名称</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>show</td>
<td style="text-align:left">是否显示</td>
<td style="text-align:left">Boolean/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td>slot</td>
<td style="text-align:left">插槽名</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>dicts</td>
<td style="text-align:left">字典数据, 数组内容由注册时决定</td>
<td style="text-align:left">Array/Function</td>
<td style="text-align:left">无</td>
<td style="text-align:left">如传入[{ value: ‘1’, label: ‘文本’, type: ‘primary’ }] , value 和 label 由注册时映射. type 为 elTag 的type, 不传则直接显示文本</td>
</tr>
<tr>
<td>render</td>
<td style="text-align:left">列渲染函数。可编写<a href="https://cn.vuejs.org/v2/guide/render-function.html#%E5%9F%BA%E7%A1%80">render 函数</a>，或安装 jsx 插件进行开发</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">(当前行相关信息, 渲染函数)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>handle</td>
<td style="text-align:left">操作项数组，见下方<a href="#操作项handle说明">操作项说明</a></td>
<td style="text-align:left">Array</td>
<td style="text-align:left">无</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>options</td>
<td style="text-align:left">elementUI 表格的其他属性，可自由配置</td>
<td style="text-align:left">Object</td>
<td style="text-align:left">不可使用函数</td>
<td style="text-align:left">{<br/>immediately: true, <br/>currentRowKey: ‘id’, <br/>firstCellType: ‘selection’, <br/>headerCellStyle: 取决于全局配置, <br/>height: 取决于全局配置,<br/>stripe: 取决于全局配置,<br/>border: 取决于全局配置<br/>}</td>
</tr>
<tr>
<td>listener</td>
<td style="text-align:left">elementUI 表格的事件，可自由配置</td>
<td style="text-align:left">Object</td>
<td style="text-align:left">无</td>
</tr>
</tbody>
</table>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th style="text-align:left">功能</th>
<th style="text-align:left">接受参数类型</th>
<th style="text-align:left">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>loadTableData</td>
<td style="text-align:left">重载列表数据，需提供 requestApi，返回 Promise 对象可使用</td>
<td style="text-align:left">无</td>
<td style="text-align:left">表单编辑、列表删除后刷新页面</td>
</tr>
<tr>
<td>searchTableData</td>
<td style="text-align:left">根据传入的对象查询列表数据，需提供 requestApi，返回 Promise 对象可使用</td>
<td style="text-align:left">Object</td>
<td style="text-align:left">搜索</td>
</tr>
<tr>
<td>batchDelTableData</td>
<td style="text-align:left">批量删除数据，自动检测是否勾选数据，需提供 deleteApi，返回 Promise 对象可使用</td>
<td style="text-align:left">任意，默认为{ids: 以,分割勾选的 id 值}</td>
<td style="text-align:left">批量删除</td>
</tr>
<tr>
<td>delTableData</td>
<td style="text-align:left">删除数据，需提供 deleteApi，返回 Promise 对象可使用</td>
<td style="text-align:left">任意，默认为{id: id}</td>
<td style="text-align:left">删除单条数据</td>
</tr>
<tr>
<td>toggleRowSelection</td>
<td style="text-align:left">切换行选中状态，根据传入的行 key 进行勾选显示，需提供 currentRowKey,默认为 id</td>
<td style="text-align:left">Array<br/>String<br/>Function</td>
<td style="text-align:left">单选列表或多选列表选中或取消选中</td>
</tr>
</tbody>
</table>
<h3 id="操作项-handle-说明"><a href="#操作项-handle-说明" class="headerlink" title="操作项 handle 说明"></a>操作项 handle 说明</h3><pre><code>handle: [{
  html: &apos;&lt;i class=&quot;el-icon-edit&quot;&gt;&lt;/i&gt;编辑&apos;,// 当前按钮的html
  show: rows =&gt; rows.row.age &gt; 18,        // 是否显示
  disabled: rows =&gt; rows.row.age &gt; 18,    // 是否不可用
  type: &apos;button&apos;,                         // 按钮类型
  style: &apos;&apos;,                              // 按钮样式
  click: rows =&gt; console.log(rows)        // 按钮点击事件
}]
</code></pre><blockquote>
<p>以上参数可直接返回字符串，也可以执行传入当前行数据的函数</p>
</blockquote>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><pre><code>&lt;template&gt;
  &lt;al-block-table ref=&apos;mainTable&apos; :table-map=&apos;tableMap&apos;&gt;&lt;/al-block-table&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &apos;AlBlockTable&apos;,

  data () {
    return {
      tableMap: {
        options: {
          requestApi: (params) =&gt; axios.get(&apos;get&apos;, params),
          requestParams: { orgId: &apos;1&apos; },
          deleteApi: (params) =&gt; axios.delete(&apos;del&apos;, params),
        },
        columns: [
          { field: &apos;name&apos;, label: &apos;姓名&apos; },
          { field: &apos;age&apos;, label: &apos;年龄&apos;,
            render: ({ row }, h) {
              return row.age &gt; 18 ? h(&apos;span&apos;, {}, &apos;成人&apos;) : h(&apos;span&apos;, {}, &apos;未成年&apos;)
            }
          },
          { field: &apos;sex&apos;, label: &apos;性别&apos;,
            dicts: [
              { label: &apos;男&apos;, value: 1, type: &apos;default&apos; },
              { label: &apos;女&apos;, value: 0, type: &apos;warning&apos; },
            ]
          },
          { field: &apos;&apos;, label: &apos;操作&apos;,
            options: { width: &apos;120px&apos; },
            handle: [{
              html: &apos;&lt;i class=&quot;el-icon-edit&quot;&gt;&lt;/i&gt;编辑&apos;,
              type: &apos;primary&apos;,
              click: rows =&gt; {
                console.log(rows)
              }
            },
            {
              html: &apos;&lt;i class=&quot;el-icon-delete&quot;&gt;&lt;/i&gt;删除&apos;,
              type: rows =&gt; rows.row.age &gt; 22 ? &apos;primary&apos; : &apos;danger&apos;,
              click: ({row}) =&gt; {
                console.log(row);
                this.$refs.mainTable.delTableData({id: row.id})
              }
            }]
          }
        ]
      }
    }
  }
}
&lt;/script&gt;
</code></pre>