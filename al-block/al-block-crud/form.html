<hr>
<p>title: al-block-form 使用说明<br>date: 2020-07-16 17:41:49<br>tags: al-block</p>
<h2 id="category-al-block"><a href="#category-al-block" class="headerlink" title="category: al-block"></a>category: al-block</h2><h2 id="表单篇"><a href="#表单篇" class="headerlink" title="表单篇"></a>表单篇</h2><p><code>Al-Block-Crud</code>对表单进行了二次封装，意为开发带来更多的便利，减少开发时多余代码的<code>Ctrl+c</code>、<code>Ctrl+v</code>。</p>
<h3 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h3><ul>
<li style="list-style: none"><input type="checkbox" checked></input> 简化表单校验开发代码</li>
<li style="list-style: none"><input type="checkbox" checked></input> 分离提交参数</li>
<li style="list-style: none"><input type="checkbox" checked></input> 自定义表单项</li>
<li style="list-style: none"><input type="checkbox" checked></input> 表单项描述</li>
<li style="list-style: none"><input type="checkbox" checked></input> 兼容<code>element-ui</code>所有属性</li>
<li style="list-style: none"><input type="checkbox" checked></input> 控制单项宽度</li>
</ul>
<h3 id="props-对象"><a href="#props-对象" class="headerlink" title="props 对象"></a>props 对象</h3><pre><code class="javascript">formMap: {
  options: {},
  formData: {},
  formComponents: []
}
</code></pre>
<blockquote>
<p><code>formData</code>为最后提交的参数，不做描述</p>
</blockquote>
<h3 id="options-对象"><a href="#options-对象" class="headerlink" title="options 对象"></a>options 对象</h3><table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>column</td>
<td style="text-align:left">显示配置，<a href="#列显示配置">详情点击此处</a>，也可直接传<code>Number</code>设置<code>span</code>的值</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>submitApi</td>
<td style="text-align:left">请求地址，需返回<code>Promise</code>对象</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>submitBefore</td>
<td style="text-align:left">保存前函数，需返回带传递参数的<code>Promise</code>对象</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>labelWidth</td>
<td style="text-align:left"><code>label</code>的宽度</td>
<td style="text-align:left">80px</td>
</tr>
<tr>
<td>labelPosition</td>
<td style="text-align:left"><code>label</code>的位置</td>
<td style="text-align:left">right</td>
</tr>
<tr>
<td>…</td>
<td style="text-align:left"><code>element-ui</code>表单的其他属性，可自由配置</td>
</tr>
</tbody>
</table>
<h3 id="列显示配置"><a href="#列显示配置" class="headerlink" title="列显示配置"></a>列显示配置</h3><table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>gutter</td>
<td style="text-align:left">每列展示间隔，可在引入时配置默认值</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td>span</td>
<td style="text-align:left">每列展示所占用的比列，共 24 等分，可在引入时配置默认值</td>
<td style="text-align:left">24</td>
</tr>
<tr>
<td>…</td>
<td style="text-align:left"><code>element-ui</code>组件<code>col</code>的其他属性，可自由配置</td>
</tr>
</tbody>
</table>
<h3 id="formComponents-数组"><a href="#formComponents-数组" class="headerlink" title="formComponents 数组"></a>formComponents 数组</h3><table>
<thead>
<tr>
<th>属性名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">函数参数</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>label</td>
<td style="text-align:left">显示文本</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">(formData)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>component</td>
<td style="text-align:left">元素类型，有效值:<code>input</code>,<code>number</code>,<code>textarea</code>,<code>select</code>,<code>checkbox</code>,<code>radio</code>,<code>switch</code>,<code>date</code>,<code>button</code>,<code>render</code></td>
<td style="text-align:left">String</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>name</td>
<td style="text-align:left">对应 formData 中的 key</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">(formData)</td>
</tr>
<tr>
<td>show</td>
<td style="text-align:left">是否显示</td>
<td style="text-align:left">Boolean/Function</td>
<td style="text-align:left">(formData)</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td>column</td>
<td style="text-align:left">列配置，<code>element-ui</code>中<code>col</code>的配置项</td>
<td style="text-align:left">Object/Function</td>
<td style="text-align:left">(formData)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>disabled</td>
<td style="text-align:left">是否不可用</td>
<td style="text-align:left">Boolean/Function</td>
<td style="text-align:left">(formData)</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td>rules</td>
<td style="text-align:left">校验规则，<a href="#表单校验rules说明">详情点击此处</a></td>
<td style="text-align:left">Object/Array/Function</td>
<td style="text-align:left">(formData)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>listeners</td>
<td style="text-align:left">事件处理集合</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>options</td>
<td style="text-align:left">elementUI 表单元素其他绑定属性</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>dataSource</td>
<td style="text-align:left">数据源，用于 radio，checkbox，select，render 组件的数据配置</td>
<td style="text-align:left">根据元素类型确定，详情见<a href="#案例">下方 dataSource</a>的运用</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>description</td>
<td style="text-align:left">描述</td>
<td style="text-align:left">String/Function</td>
<td style="text-align:left">(formData)</td>
</tr>
</tbody>
</table>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th>事件名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>submit</td>
<td style="text-align:left">提交的方法，需要和<code>submitApi</code>配合使用</td>
<td style="text-align:left">提交请求后的<code>Promise</code>对象</td>
</tr>
<tr>
<td>valid</td>
<td style="text-align:left">表单校验</td>
<td style="text-align:left"><code>Boolean</code>类型的<code>true</code>/<code>false</code></td>
</tr>
<tr>
<td>reset</td>
<td style="text-align:left">重置表单</td>
<td style="text-align:left">无</td>
</tr>
</tbody>
</table>
<h3 id="表单校验-rules-说明"><a href="#表单校验-rules-说明" class="headerlink" title="表单校验 rules 说明"></a>表单校验 rules 说明</h3><pre><code class="javascript">rules: {
  required: <span class="literal">true</span>,          <span class="comment">// 开启必填校验</span>
  required: {
    message: <span class="string">'请输入xxx'</span>    <span class="comment">// 错误时提示的消息，见下方说明</span>
  },
  required: [{
    required: <span class="literal">true</span>,
    message: <span class="string">'请输入xxx'</span>,
    trigger: [<span class="string">'change'</span>, <span class="string">'blur'</span>]
  }],
  phone: <span class="literal">true</span>,          <span class="comment">// 开启手机号校验</span>
  phone: {},
  email: <span class="literal">true</span>,          <span class="comment">// 开启邮箱校验</span>
  email: {},
  number: <span class="literal">true</span>,         <span class="comment">// 开启数字校验</span>
  number: {},
  code: <span class="literal">true</span>,           <span class="comment">// 开启数字和字母校验</span>
  code: {},
  port: <span class="literal">true</span>,           <span class="comment">// 开启端口校验</span>
  port: {},
  ip: <span class="literal">true</span>,             <span class="comment">// 开启ip校验</span>
  ip: {
    contain: <span class="string">'localhost'</span>   <span class="comment">// 可传入数组或以,分割的字符串</span>
  },
  integer: <span class="literal">true</span>,        <span class="comment">// 开启整数校验</span>
  integer: {
    positive: <span class="literal">true</span>,   <span class="comment">// 正整数，与负整数二选一</span>
    negative: <span class="literal">true</span>,   <span class="comment">// 负整数，与正整数二选一</span>
    containZero: <span class="literal">true</span>,<span class="comment">// 是否包含0， 在正负整数设置时有效</span>
    min: <span class="number">1</span>,           <span class="comment">// 最小值</span>
    max: <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">10</span>,    <span class="comment">// 最大值</span>
  },
  length: {
    min: <span class="number">1</span>,           <span class="comment">// 最小值</span>
    max: <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">10</span>,    <span class="comment">// 最大值</span>
    len: <span class="number">5</span>            <span class="comment">// 特定长度</span>
  },
  regular: {
    pattern: <span class="regexp">/./</span>
  },
  specialChar: {
    message: <span class="function"><span class="params">char</span> =&gt;</span> <span class="string">`存在非法字符<span class="subst">${char}</span>`</span>,   <span class="comment">// 自定义提示可接受过滤后所包含的的特殊字符</span>
    filter: <span class="string">'all'</span>                           <span class="comment">// 过滤所有特殊字符</span>
    filter: <span class="string">'@s.'</span>                           <span class="comment">// 过滤@.两个特殊字符（以s分割的字符串）</span>
    filter: [<span class="string">"@"</span>, <span class="string">"."</span>]                      <span class="comment">// 过滤@.两个特殊字符</span>
  }
}
</code></pre>
<blockquote>
<ol>
<li>可传返回对应类型的函数或对应类型数据，如<code>length</code>中最大值和最小值的用法等效。</li>
<li>若只需开启某规则不定义其他属性，可直接设置 true 属性，反之亦然。<em>可设置 Boolean 类型的已全部罗列<a href="#表单校验rules说明">上方说明</a></em>，如<code>required</code>。</li>
<li>若当前规则需要添加其他属性，可使用 Object 对象进行配置，<em>规则为 Object 对象时也为开启状态</em>。如<code>required</code>。</li>
<li><code>message</code>都<strong>存在</strong>默认提示，不传则使用默认提示。</li>
<li>可传入支持<code>elementUI</code>封装的数据格式。</li>
</ol>
</blockquote>
<h3 id="组件-input-说明"><a href="#组件-input-说明" class="headerlink" title="组件 input 说明"></a>组件 input 说明</h3><pre><code class="javascript">{
  label: <span class="string">'输入框'</span>,
  component: <span class="string">'input'</span>,
  show: <span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">true</span>,
  name: <span class="string">'input'</span>,
  rules: {
    required: {
      message: <span class="string">'请输入输入框'</span>
    }
  },
  options: {
    slots: {
      prefix: <span class="function">(<span class="params">data, h</span>) =&gt;</span> h(<span class="string">'i'</span>, { <span class="attr">class</span>: <span class="string">'el-icon-search'</span> })
    }
  },
  description: <span class="string">'这是一条说明'</span>
}
</code></pre>
<blockquote>
<p>此处<code>slot</code>对象 key 需要和 input 框<code>slot</code>的<code>name</code>对应,否则将不会生效。可接受表单数据和<a href="https://cn.vuejs.org/v2/guide/render-function.html#%E5%9F%BA%E7%A1%80">render 函数</a>进行渲染</p>
</blockquote>
<h3 id="组件-render-说明"><a href="#组件-render-说明" class="headerlink" title="组件 render 说明"></a>组件 render 说明</h3><p>以 <code>el-color-picker</code> 色彩选择器为例</p>
<pre><code class="javascript">{
  label: <span class="string">'render组件'</span>,
  component: <span class="string">'render'</span>,
  name: <span class="string">'render'</span>,
  dataSource: <span class="function">(<span class="params">formData, h</span>) =&gt;</span> {
    <span class="keyword">return</span> h(<span class="string">"el-color-picker"</span>, {
      props: {
        value: formData.render
      },
      on: {
        change: <span class="function"><span class="params">val</span> =&gt;</span> {
          <span class="keyword">this</span>.$set(formData, <span class="string">'render'</span>, val)
        }
      }
    });
  }
}
</code></pre>
<blockquote>
<p>此处<code>dataSource</code>接收当前表单数据和渲染函数，可通过此函数进行<a href="https://cn.vuejs.org/v2/guide/render-function.html#%E5%9F%BA%E7%A1%80">render 函数</a>的渲染</p>
</blockquote>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><pre><code class="javascript">&lt;template&gt;
  &lt;al-block-form ref=<span class="string">'mainForm'</span> :formMap=<span class="string">"formMap"</span> /&gt;
&lt;<span class="regexp">/template&gt;</span>
<span class="regexp"></span>
<span class="regexp">&lt;script&gt;</span>
<span class="regexp">export default {</span>
<span class="regexp">  data () {</span>
<span class="regexp">    formMap: {</span>
<span class="regexp">      options: {</span>
<span class="regexp">        submitApi: axios.post('save')</span>
<span class="regexp">      },</span>
<span class="regexp">      formData: {</span>
<span class="regexp">        input: '',</span>
<span class="regexp">        number: 0,</span>
<span class="regexp">        textarea: '',</span>
<span class="regexp">        date: new Date(),</span>
<span class="regexp">        select: '1',</span>
<span class="regexp">        checkbox: ['1'],</span>
<span class="regexp">        radio: '1',</span>
<span class="regexp">        switch: 1,</span>
<span class="regexp">        render: ''</span>
<span class="regexp">      },</span>
<span class="regexp">      formComponents: [{</span>
<span class="regexp">        label: '输入框',</span>
<span class="regexp">        component: 'input',</span>
<span class="regexp">        name: 'input',</span>
<span class="regexp">        show: (formData) =&gt; Boolean(formData.id), // 当存在id时显示</span>
<span class="regexp">        rules: {</span>
<span class="regexp">          required: {</span>
<span class="regexp">            message: '请输入输入框'</span>
<span class="regexp">          }</span>
<span class="regexp">        },</span>
<span class="regexp">        listeners: {</span>
<span class="regexp">          change: value =&gt; console.log(value)</span>
<span class="regexp">        },</span>
<span class="regexp">        options: {</span>
<span class="regexp">          placeholder: '请输入输入框',</span>
<span class="regexp">          slots: {</span>
<span class="regexp">            prefix: (data, h) =&gt; h('i', { class: 'el-icon-search' })</span>
<span class="regexp">          }</span>
<span class="regexp">        }</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '数字框',</span>
<span class="regexp">        component: 'number',</span>
<span class="regexp">        name: 'number',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        rules: [],</span>
<span class="regexp">        description: '这是一个数字框'</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '文本框',</span>
<span class="regexp">        component: 'textarea',</span>
<span class="regexp">        name: 'textarea',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        options: {</span>
<span class="regexp">          autosize: { minRows: 1, maxRows: 3 }</span>
<span class="regexp">        }</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '日期',</span>
<span class="regexp">        component: 'date',</span>
<span class="regexp">        name: 'date',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '下拉框',</span>
<span class="regexp">        component: 'select',</span>
<span class="regexp">        name: 'select',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        dataSource: [{</span>
<span class="regexp">          value: '1',</span>
<span class="regexp">          label: '下拉框',</span>
<span class="regexp">          disabled: true</span>
<span class="regexp">        },</span>
<span class="regexp">        {</span>
<span class="regexp">          value: '2',</span>
<span class="regexp">          label: '下拉框2',</span>
<span class="regexp">          disabled: false</span>
<span class="regexp">        }]</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '复选框',</span>
<span class="regexp">        component: 'checkbox',</span>
<span class="regexp">        name: 'checkbox',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        dataSource: [{</span>
<span class="regexp">          value: '1',</span>
<span class="regexp">          label: '复选框1'</span>
<span class="regexp">        },</span>
<span class="regexp">        {</span>
<span class="regexp">          value: '2',</span>
<span class="regexp">          label: '复选框2'</span>
<span class="regexp">        }]</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '单选框',</span>
<span class="regexp">        component: 'radio',</span>
<span class="regexp">        name: 'radio',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        dataSource: [{</span>
<span class="regexp">          value: '1',</span>
<span class="regexp">          label: '单选框1'</span>
<span class="regexp">        },</span>
<span class="regexp">        {</span>
<span class="regexp">          value: '2',</span>
<span class="regexp">          label: '单选框2'</span>
<span class="regexp">        }]</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '开关',</span>
<span class="regexp">        component: 'switch',</span>
<span class="regexp">        name: 'switch',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        options: {</span>
<span class="regexp">          activeValue: '1',</span>
<span class="regexp">          inactiveValue: '0'</span>
<span class="regexp">        }</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: '按钮',</span>
<span class="regexp">        component: 'button',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        listeners: {</span>
<span class="regexp">          click: _ =&gt; console.log(this.formMap.formData)</span>
<span class="regexp">        },</span>
<span class="regexp">        dataSource: [{</span>
<span class="regexp">          html: '&lt;i class="el-icon el-icon-plus"&gt;&lt;/i&gt;&lt;span&gt;按钮&lt;/span&gt;',</span>
<span class="regexp">          type: 'primary',</span>
<span class="regexp">          style: 'width: 100%',</span>
<span class="regexp">          click: formData =&gt; console.log(formData)</span>
<span class="regexp">        }]</span>
<span class="regexp">      },</span>
<span class="regexp">      {</span>
<span class="regexp">        label: 'render组件',</span>
<span class="regexp">        component: 'render',</span>
<span class="regexp">        name: 'render',</span>
<span class="regexp">        show: () =&gt; true,</span>
<span class="regexp">        disabled: () =&gt; false,</span>
<span class="regexp">        dataSource: (data, h) =&gt; {</span>
<span class="regexp">          return h("el-color-picker", {</span>
<span class="regexp">            props: {</span>
<span class="regexp">              value: this.formMap.formData.render</span>
<span class="regexp">            },</span>
<span class="regexp">            on: {</span>
<span class="regexp">              change: val =&gt; {</span>
<span class="regexp">                this.$set(this.formMap.formData, 'render', val)</span>
<span class="regexp">              }</span>
<span class="regexp">            }</span>
<span class="regexp">          });</span>
<span class="regexp">        }</span>
<span class="regexp">      }]</span>
<span class="regexp">    }</span>
<span class="regexp">  },</span>
<span class="regexp"></span>
<span class="regexp">  methods: {</span>
<span class="regexp">    /</span>**
     * 提交表单
     *<span class="regexp">/</span>
<span class="regexp">    handleBtnClick () {</span>
<span class="regexp">      this.$refs.mainForm.submitForm().then(res =&gt; {</span>
<span class="regexp">        console.log(res)</span>
<span class="regexp">      })</span>
<span class="regexp">    }</span>
<span class="regexp">  }</span>
<span class="regexp">}</span>
<span class="regexp">&lt;/</span>script&gt;
</code></pre>
